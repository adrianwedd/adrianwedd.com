---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Search" description="Search across all projects, blog posts, audio, and gallery.">
  <section class="mx-auto max-w-3xl px-4 py-16 sm:px-6 lg:px-8">
    <h1 class="mb-8 text-text">Search</h1>
    <div id="search" class="search-container"></div>
    <div id="search-skeleton" class="space-y-4">
      <div class="h-12 animate-pulse rounded-lg border border-border bg-surface-alt"></div>
      <div class="space-y-3 pt-4">
        <div class="h-4 w-3/4 animate-pulse rounded bg-surface-alt"></div>
        <div class="h-3 w-full animate-pulse rounded bg-surface-alt"></div>
        <div class="h-3 w-5/6 animate-pulse rounded bg-surface-alt"></div>
      </div>
      <div class="space-y-3 pt-2">
        <div class="h-4 w-2/3 animate-pulse rounded bg-surface-alt"></div>
        <div class="h-3 w-full animate-pulse rounded bg-surface-alt"></div>
        <div class="h-3 w-4/5 animate-pulse rounded bg-surface-alt"></div>
      </div>
    </div>
  </section>
</BaseLayout>

<link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
<script is:inline>
  window.addEventListener('DOMContentLoaded', async () => {
    const script = document.createElement('script');
    script.src = '/pagefind/pagefind-ui.js';
    script.onload = () => {
      new PagefindUI({
        element: '#search',
        showSubResults: true,
        showImages: true,
      });
      var skeleton = document.getElementById('search-skeleton');
      if (skeleton) skeleton.remove();
    };
    document.head.appendChild(script);
  });
</script>

<style is:global>
  /* Pagefind UI theme overrides â€” maps to site's --color-* custom properties */
  :root {
    --pagefind-ui-scale: 1;
    --pagefind-ui-primary: var(--color-accent);
    --pagefind-ui-text: var(--color-text);
    --pagefind-ui-background: var(--color-surface);
    --pagefind-ui-border: var(--color-border);
    --pagefind-ui-tag: var(--color-surface-alt);
    --pagefind-ui-border-width: 1px;
    --pagefind-ui-border-radius: 0.5rem;
    --pagefind-ui-font: inherit;
  }

  .pagefind-ui__search-input {
    background: var(--color-surface-alt) !important;
    color: var(--color-text) !important;
  }

  .pagefind-ui__search-input::placeholder {
    color: var(--color-text-muted) !important;
  }

  .pagefind-ui__search-input:focus {
    outline: 2px solid var(--color-accent) !important;
    outline-offset: 2px;
  }

  .pagefind-ui__result-link {
    color: var(--color-accent) !important;
  }

  .pagefind-ui__result-link:hover {
    text-decoration: underline !important;
  }

  .pagefind-ui__result-excerpt {
    color: var(--color-text-muted) !important;
  }

  .pagefind-ui__result-excerpt mark {
    background: var(--color-accent-muted) !important;
    color: var(--color-text) !important;
    padding: 0.1em 0.2em;
    border-radius: 2px;
  }

  .pagefind-ui__message {
    color: var(--color-text-muted) !important;
  }

  .pagefind-ui__button {
    background: var(--color-surface-alt) !important;
    color: var(--color-text) !important;
    border-color: var(--color-border) !important;
  }

  .pagefind-ui__button:hover {
    border-color: var(--color-accent) !important;
    color: var(--color-accent) !important;
  }

  .pagefind-ui__result {
    border-color: var(--color-border) !important;
  }

  .pagefind-ui__result-title {
    color: var(--color-text) !important;
  }
</style>
