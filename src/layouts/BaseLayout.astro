---
import SEOHead from '../components/SEOHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ConsentBanner from '../components/ConsentBanner.astro';
import Analytics from '../components/Analytics.astro';
import TerminalEasterEgg from '../components/islands/TerminalEasterEgg';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  image?: string;
  type?: 'website' | 'article';
  publishedDate?: string;
  tags?: string[];
  noindex?: boolean;
}

const props = Astro.props;
---

<!doctype html>
<!--

     █████╗ ██████╗ ██████╗ ██╗ █████╗ ███╗   ██╗
    ██╔══██╗██╔══██╗██╔══██╗██║██╔══██╗████╗  ██║
    ███████║██║  ██║██████╔╝██║███████║██╔██╗ ██║
    ██╔══██║██║  ██║██╔══██╗██║██╔══██║██║╚██╗██║
    ██║  ██║██████╔╝██║  ██║██║██║  ██║██║ ╚████║
    ╚═╝  ╚═╝╚═════╝ ╚═╝  ╚═╝╚═╝╚═╝  ╚═╝╚═╝  ╚═══╝
                    W E D D

    You're reading the source. Nice.

    Built with Astro, Tailwind, and Preact.
    Keyboard shortcuts: press ? on any page.
    Source: https://github.com/adrianwedd/adrianwedd.com

    Looking for work in AI safety, systems, or infrastructure.
    Say hello: https://adrianwedd.com/contact/

-->
<html lang="en">
  <head>
    <meta name="author" content="Adrian Wedd" />
    <meta name="generator" content="Astro + curiosity" />
    <SEOHead {...props} />
    {/* Prevent flash of wrong theme */}
    <script is:inline>
      (function () {
        var t = localStorage.getItem('theme');
        if (t === 'light' || (!t && window.matchMedia('(prefers-color-scheme: light)').matches)) {
          document.documentElement.classList.add('light');
        }
        if (!sessionStorage.getItem('_welcomed')) {
          sessionStorage.setItem('_welcomed', '1');
          console.log(
            '%c adrianwedd.com ',
            'background:#c48b6e;color:#1a181c;font-weight:bold;font-size:14px;padding:4px 8px;border-radius:4px',
          );
          console.log('Press ? for keyboard shortcuts. Source: https://github.com/adrianwedd/adrianwedd.com');
        }
      })();
    </script>
  </head>
  <body class="flex min-h-screen flex-col">
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:fixed focus:left-2 focus:top-2 focus:z-[100] focus:rounded-lg focus:bg-accent focus:px-4 focus:py-2 focus:text-sm focus:font-medium focus:text-surface"
    >
      Skip to main content
    </a>
    <Header />
    <main id="main-content" class="flex-1">
      <slot />
    </main>
    {/* Back to top */}
    <button
      id="back-to-top"
      type="button"
      class="fixed bottom-6 right-6 z-40 hidden h-10 w-10 items-center justify-center rounded-full border border-border bg-surface-alt text-text-muted shadow-subtle transition-all hover:border-accent hover:text-accent"
      aria-label="Back to top"
    >
      <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" />
      </svg>
    </button>
    <Footer />
    <ConsentBanner />
    <Analytics />
    <TerminalEasterEgg client:idle />

    {/* Keyboard shortcuts overlay */}
    <div id="kb-overlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 backdrop-blur-sm" role="dialog" aria-modal="true" aria-label="Keyboard shortcuts">
      <div class="mx-4 max-w-sm rounded-xl border border-border bg-surface p-6 shadow-raised" id="kb-dialog">
        <div class="mb-4 flex items-center justify-between">
          <h2 class="text-lg font-semibold text-text">Keyboard shortcuts</h2>
          <button id="kb-close" class="rounded-lg p-1 text-text-muted transition-colors hover:bg-surface-alt hover:text-text" aria-label="Close">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div class="space-y-3 text-sm">
          <p class="text-xs font-medium uppercase tracking-wider text-text-muted">Navigation</p>
          <div class="grid grid-cols-[auto_1fr] gap-x-4 gap-y-1.5">
            <kbd class="rounded bg-surface-alt px-1.5 py-0.5 font-mono text-xs text-accent">g h</kbd><span class="text-text">Home</span>
            <kbd class="rounded bg-surface-alt px-1.5 py-0.5 font-mono text-xs text-accent">g b</kbd><span class="text-text">Blog</span>
            <kbd class="rounded bg-surface-alt px-1.5 py-0.5 font-mono text-xs text-accent">g p</kbd><span class="text-text">Projects</span>
            <kbd class="rounded bg-surface-alt px-1.5 py-0.5 font-mono text-xs text-accent">g g</kbd><span class="text-text">Gallery</span>
            <kbd class="rounded bg-surface-alt px-1.5 py-0.5 font-mono text-xs text-accent">g n</kbd><span class="text-text">Now</span>
            <kbd class="rounded bg-surface-alt px-1.5 py-0.5 font-mono text-xs text-accent">g a</kbd><span class="text-text">About</span>
          </div>
          <p class="mt-1 text-xs font-medium uppercase tracking-wider text-text-muted">Actions</p>
          <div class="grid grid-cols-[auto_1fr] gap-x-4 gap-y-1.5">
            <kbd class="rounded bg-surface-alt px-1.5 py-0.5 font-mono text-xs text-accent">/</kbd><span class="text-text">Search</span>
            <kbd class="rounded bg-surface-alt px-1.5 py-0.5 font-mono text-xs text-accent">t</kbd><span class="text-text">Toggle theme</span>
            <kbd class="rounded bg-surface-alt px-1.5 py-0.5 font-mono text-xs text-accent">?</kbd><span class="text-text">This help</span>
          </div>
        </div>
      </div>
    </div>

    <script is:inline>
      (function () {
        var pending = '';
        var timer;
        var overlay = document.getElementById('kb-overlay');
        var closeBtn = document.getElementById('kb-close');
        var helpTrigger = null;

        function isTyping(e) {
          var t = e.target;
          return t.tagName === 'INPUT' || t.tagName === 'TEXTAREA' || t.tagName === 'SELECT' || t.isContentEditable;
        }

        function showHelp() {
          helpTrigger = document.activeElement;
          overlay.classList.remove('hidden');
          overlay.classList.add('flex');
          closeBtn.focus();
        }

        function hideHelp() {
          overlay.classList.add('hidden');
          overlay.classList.remove('flex');
          if (helpTrigger && helpTrigger.focus) helpTrigger.focus();
          helpTrigger = null;
        }

        var routes = { h: '/', b: '/blog/', p: '/projects/', g: '/gallery/', n: '/now/', a: '/about/' };

        document.addEventListener('keydown', function (e) {
          if (isTyping(e) || e.ctrlKey || e.metaKey || e.altKey) return;

          var key = e.key;

          // Close overlay on Escape
          if (key === 'Escape') { hideHelp(); pending = ''; return; }

          // Show help
          if (key === '?') { e.preventDefault(); showHelp(); return; }

          // Toggle theme
          if (key === 't' && !pending) {
            e.preventDefault();
            document.documentElement.classList.toggle('light');
            localStorage.setItem('theme', document.documentElement.classList.contains('light') ? 'light' : 'dark');
            return;
          }

          // Focus search
          if (key === '/' && !pending) {
            e.preventDefault();
            var searchInput = document.querySelector('[data-pagefind-ui] input, input[type="search"]');
            if (searchInput) { searchInput.focus(); }
            else { window.location.href = '/search/'; }
            return;
          }

          // g + key navigation
          if (key === 'g' && !pending) {
            pending = 'g';
            clearTimeout(timer);
            timer = setTimeout(function () { pending = ''; }, 1000);
            return;
          }

          if (pending === 'g' && routes[key]) {
            e.preventDefault();
            pending = '';
            clearTimeout(timer);
            window.location.href = routes[key];
            return;
          }

          pending = '';
        });

        closeBtn.addEventListener('click', hideHelp);
        overlay.addEventListener('click', function (e) {
          if (e.target === overlay) hideHelp();
        });
      })();
    </script>

    <script is:inline>
      (function () {
        var btn = document.getElementById('back-to-top');
        if (!btn) return;
        var shown = false;
        window.addEventListener('scroll', function () {
          var shouldShow = window.scrollY > window.innerHeight;
          if (shouldShow !== shown) {
            shown = shouldShow;
            btn.classList.toggle('hidden', !shown);
            btn.classList.toggle('flex', shown);
          }
        }, { passive: true });
        btn.addEventListener('click', function () {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      })();
    </script>
  </body>
</html>
